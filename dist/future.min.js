/*! Futurejs 0.2.0 2013-12-28 */
!function(){function a(a){return"undefined"==typeof a}function b(a){return"[object Function]"==Object.prototype.toString.call(a)}var c=this,d=function(c,d){if(!a(c)){var e;e=b(c)?c():c,this._pending=!1,d?(this._withError=!0,this._error=e):this._data=e}this._callbacks=[]};d.value=function(a){return new d(a)},d.sync=function(a){return new d(a)},d.error=function(a){return new d(a,!0)},d.prototype._pending=!0,d.prototype._data=null,d.prototype._error=null,d.prototype._withError=!1,d.prototype._callbacks=null,d.prototype.then=function(c,e){if(!b(c))throw new Error("onValue callback must be a function");var f=e;if(null!=f&&!a(f)&&!b(f)&&(e=e||{},f=e.onError,!b(f)))throw new Error("onError callback must be a function");var g=new d;return this._pending?this._callbacks.push({onValue:c,onError:f,errorHandled:!1,f:g}):this._innerComplete({onValue:c,onError:f,errorHandled:!1,f:g}),g},d.prototype.catchError=function(a,b){return this.then(function(){},function(c){if(!b||b(c))return a(c);throw c})},d.prototype.whenComplete=function(a){return this.then(function(b){var c=a();return c instanceof d?c.then(function(){return b}):b},{onError:function(b){var c=a();if(c instanceof d)return c.then(function(){throw b});throw b}})},d.prototype._complete=function(a){if(!this._pending)throw new Error("Future already completed");this._pending=!1,this._data=a,this._dispatchCompletion()},d.prototype._innerComplete=function(b){var c;try{if(this._withError){if(!b.onError)throw this._error;c=b.onError(this._error)}else c=b.onValue(this._data)}catch(e){return b.f._completeError(e),void 0}a(c)&&(c=this._data),c instanceof d?c.then(function(a){b.f._complete(a)}).catchError(function(a){b.f._completeError(a)}):b.f._complete(c)},d.prototype._completeError=function(a){if(!this._pending)throw new Error("Future already completed");this._pending=!1,this._withError=!0,this._error=a,this._dispatchCompletion()},d.prototype._dispatchCompletion=function(){var a=this._callbacks.length;if(this._withError&&0==a)throw this._error;for(var b=0;a>b;b++)this._innerComplete(this._callbacks[b])};var e=function(){this.future=new d};e.prototype.future=null,e.prototype.complete=function(a){this.future._complete(a)},e.prototype.completeError=function(a){this.future._completeError(a)},e.prototype.isCompleted=function(){return!this.future._pending},"undefined"!=typeof exports?(module.exports.Future=d,module.exports.Completer=e):(c.Future=d,c.Completer=e)}();