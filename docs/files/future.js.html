<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>future.js - Futurejs</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Futurejs"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Completer.html">Completer</a></li>
            
                <li><a href="../classes/Future.html">Future</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: future.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Futurejs v{{VERSION}}
 * https://github.com/ertrzyiks/futurejs
 *
 * Dart Future and Completer features ported to javascript.
 */
(function(){
	
	var root = this;
	
	/**
	 * @class Future
	 * @constructor
	 * @param value {Object, Function}
	 * @param withError {boolean}
	 */
	var Future = function( value, withError )
	{ 
		if ( !isUndefined( value ) )
		{
			var v;
			if ( isFunction( value ) )
			{
				v = value();
			}
			else
			{
				v = value;
			}
			
			this._pending = false;
			if ( withError )
			{
				this._withError = true;
				this._error = v;
			}
			else
			{
				this._data = v;
			}
		}
		
		this._callbacks = [];
	};
	
	/**
	 * @constructor
	 * @param value {Object}
	 */
	Future.value = function( value )
	{
		return new Future( value );
	}
	
	/**
	 * @constructor
	 * @param value {Function}
	 */
	Future.sync = function( value )
	{
		return new Future( value );
	}
	
	/**
	 * @constructor
	 * @param value {Object, Function}
	 */
	Future.error = function( error )
	{
		return new Future( error, true );
	}
	
	/**
	 * @property _pending {boolean}
	 * @private
	 */
	Future.prototype._pending = true;
	
	/**
	 * @property _data {Object}
	 * @private
	 */
	Future.prototype._data = null;
	
	/**
	 * @property _error {Object}
	 * @private
	 */
	Future.prototype._error = null;
	
	/**
	 * @property _withError {boolean}
	 * @private
	 */
	Future.prototype._withError = false;
	
	/**
	 * @property _callbacks {Array}
	 * @private
	 */
	Future.prototype._callbacks = null;
	
	/**
	 * @method then
	 * @param onValue {Function}
	 * @param [options] {Object}
	 */
	Future.prototype.then = function( onValue, options )
	{
		if( !isFunction(onValue) )
		{
			throw new Error(&quot;onValue callback must be a function&quot;);
		}
		
		var onError = options;
		
		if( onError != null &amp;&amp; !isUndefined(onError) &amp;&amp; !isFunction(onError) )
		{
			options = options || {};
			onError = options.onError;
			
			if( !isFunction(onError) )
			{
				throw new Error(&quot;onError callback must be a function&quot;);
			}
		}
		
		var future = new Future();
		
		if ( this._pending )
		{
			this._callbacks.push( { 
				onValue: onValue,
				onError: onError,
				errorHandled: false,
				f: future
			} );
		}
		else
		{
			this._innerComplete( { 
				onValue: onValue,
				onError: onError,
				errorHandled: false,
				f: future
			} );
		}
		
		return future;
	};
	
	/**
	 * @method catchError
	 * @param onError {Function}
	 * @param [test] {Function}
	 */
	Future.prototype.catchError = function( onError, test )
	{
		return this.then( function(){}, function( e ){
			if( !test || test( e ) )
			{
				return onError( e );
			}
			
			throw e;
		});
	};
	
	/**
	 * @method whenComplete
	 * @param action {Function}
	 */
	Future.prototype.whenComplete = function( action )
	{
		return this.then(
			function( data ){
				var f2 = action();
				if ( f2 instanceof Future ) return f2.then(function(){ return data; });
				return data;
			}, 
			{ onError: function(e){
				var f2 = action();
				if ( f2 instanceof Future ) return f2.then( function(){ throw e; });
				throw e;
			} }
		);
	};
	
	/**
	 * @method _complete
	 * @private
	 */
	Future.prototype._complete = function( data )
	{
		if( !this._pending )
		{
			throw new Error(&quot;Future already completed&quot;);
		}
		
		this._pending = false;
		this._data = data;
		
		this._dispatchCompletion();
	};
	
	/**
	 * @method _innerComplete
	 * @private
	 */
	Future.prototype._innerComplete = function( data )
	{
		var result;
		try
		{
			if( this._withError )
			{
				if( !data.onError )
				{
					throw this._error;
				}
				result = data.onError( this._error );
			}
			else
			{
				result = data.onValue( this._data );
			}
		}
		catch( e )
		{
			data.f._completeError( e );
			return;
		}
		
		if ( isUndefined(result) )
		{
			result = this._data;
		}
		
		if ( result instanceof Future )
		{
			result
				.then(function( v ){
					data.f._complete( v );
				})
				.catchError(function( e ){
					data.f._completeError( e );
				});
		}
		else
		{
			data.f._complete( result );
		}
	};
	
	/**
	 * @method _completeError
	 * @private
	 */
	Future.prototype._completeError = function( error )
	{
		if( !this._pending )
		{
			throw new Error(&quot;Future already completed&quot;);
		}
		
		this._pending = false;
		this._withError = true;
		this._error = error;
		
		this._dispatchCompletion();
	};
	
	/**
	 * @method _dispatchCompletion
	 * @private
	 */
	Future.prototype._dispatchCompletion = function()
	{
		var len = this._callbacks.length, 
			errorHandled;
		
		if ( this._withError &amp;&amp; len == 0 )
		{
			throw this._error;
		}
			
		for( var i = 0; i &lt; len; i++ )
		{
			this._innerComplete( this._callbacks[i] );
		}
	};
	
	/**
	 *	@class Completer
	 *	@constructor
	 */
	var Completer = function()
	{ 
		this.future = new Future();
	};
	
	/**
	 * @property future
	 */
	Completer.prototype.future = null;
	
	/**
	 * @method complete
	 * @param data {Object}
	 */
	Completer.prototype.complete = function( data )
	{
		this.future._complete( data );
	};
	
	/**
	 * @method completeError
	 * @param error {Object}
	 */
	Completer.prototype.completeError = function( error )
	{
		this.future._completeError( error );
	};
	
	/**
	 * @method isCompleted
	 */
	Completer.prototype.isCompleted = function()
	{
		return !this.future._pending;
	};
	
	
	
	if (typeof exports !== &#x27;undefined&#x27;) 
	{
		module.exports.Future = Future;
		module.exports.Completer = Completer;
	} 
	else 
	{
		root.Future = Future;
		root.Completer = Completer;
	}
	
	function isUndefined(obj)
	{
		return typeof(obj) == &quot;undefined&quot;;
	}
	
	function isFunction(obj) 
	{
		  return Object.prototype.toString.call(obj) == &#x27;[object Function]&#x27;;
	}
	
})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
